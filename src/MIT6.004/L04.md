# L04 Procedures and MMIO

---

MIT 6.004 2019 L04 Procedures and MMIO，由Silvina Hanono Wachman讲述。

本讲座深入讲解了汇编语言中程序（Procedures）的处理，尤其是关于参数传递、内存访问以及更复杂例子的实现。

## 主要内容

### 1. **程序和内存操作回顾**

- 回顾了程序处理中的关键概念，如参数传递、返回值、局部变量和程序退出点。
- 强调了使用栈（Stack）和激活记录（Activation Record）来管理程序调用所需的信息。

### 2. **内存操作详解**

- 详细区分了加载（Load）和存储（Store）指令与立即数加载（Load Immediate）的不同，明确了后者并不访问内存。
- 讨论了使用栈进行数据保存和恢复的具体方法，包括如何通过调整栈指针（Stack Pointer）来保存和恢复寄存器值。

### 3. **嵌套程序和递归程序**

- 介绍了嵌套程序调用中保存返回地址（Return Address）的重要性，特别是当程序中有多层调用时如何使用栈来管理这些地址。
- 通过斐波那契数列的计算示例详细展示了如何实现递归程序。

### 4. **使用指针传递数组**

- 讨论了如何通过指针而不是直接通过值来传递数组给程序，以处理大型数据结构。
- 通过查找数组中的最大值的示例演示了如何在程序中使用指针和内存访问来处理数组数据。

### 5. **内存布局和MMIO**

- 解释了内存的不同区域（如栈、堆、静态区和代码区）以及它们的用途。
- 简要介绍了内存映射I/O（Memory-Mapped I/O，MMIO）的概念，为后续实验室内容预设背景。

### 6. **参数传递的选择和优化**

- 讨论了何时选择直接传递值与何时使用指针传递参数的考量，特别是在参数数量超出寄存器数量时的策略。

## 总结

本讲座通过具体的示例和讲解，深入探讨了程序的实现和管理，尤其是在处理复杂数据结构和递归程序方面的高级技巧。通过对栈的操作和内存访问的详细讨论，为学生提供了在汇编语言中有效管理程序状态和内存的方法。此外，讲座还介绍了程序设计中的一些优化策略，如使用指针来传递大型数据结构，以及选择适当的参数传递方式来提高程序的效率和灵活性。
